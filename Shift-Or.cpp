#include <iostream>
#include <vector>

const int CHAR_SET_SIZE = 256;  // ?????? ??????????? ?????? (ASCII)

// ??????? ??? ?????????? ?????? ? ?????????????? ????????? Shift-Or
std::vector<int> shiftOrSearch(const std::string& text, const std::string& pattern) {
    int m = pattern.length();
    int n = text.length();

    // ????????????? ??????? ?????
    std::vector<unsigned int> mask(CHAR_SET_SIZE, ~0);

    // ????????? ????? ??? ???????? ?????????
    for (int i = 0; i < m; ++i) {
        mask[pattern[i]] &= ~(1 << i);
    }

    // ????????????? ?????????
    unsigned int state = ~0;

    // ?????????? ??????
    std::vector<int> occurrences;
    for (int i = 0; i < n; ++i) {
        state = (state << 1) | 1;
        state &= mask[text[i]];

        if (!(state & (1 << (m - 1)))) {
            occurrences.push_back(i - m + 1);
        }
    }

    return occurrences;
}

int main() {
    std::string text = "ababcababcabcabc";
    std::string pattern = "abc";

    std::vector<int> result = shiftOrSearch(text, pattern);

    std::cout << "Shift-Or\npattern: " << pattern << " text: " << text << ": ";
    for (int index : result) {
        std::cout << index << " ";
    }
    std::cout << std::endl;

    return 0;
}

